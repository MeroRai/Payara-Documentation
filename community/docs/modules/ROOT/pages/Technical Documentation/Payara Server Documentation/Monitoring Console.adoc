[[monitoring-console]]
= Monitoring Console
:ordinal: 11

The monitoring console module collects a multitude of metrics from all nodes and accumulates the data on the DAS.

The data is visualised by the *Monitoring Console* web-application.

The metrics include server metrics as well as metrics defined in user applications using the _MicroProfile Metrics_ _MicroProfile Health_ APIs.

NOTE: Please be aware that the details documented in this chapter reflect the current state of an evolving product that are likely to change in the future.

[[enabling-the-gui]]
== Enabling the GUI

To enable the Monitoring Console run the following Asadmin command:

[source, shell]
----
asadmin> set-monitoring-console-configuration --enabled=true
----

The console is now available at `http://localhost:8080/monitoring-console/`. Like the Admin console's user interface, the monitoring console only runs on the DAS.

To stop the Monitoring Console run this command:

[source, shell]
----
asadmin> set-monitoring-console-configuration --enabled=false
----

TIP: Stopping the application does not disable the data collection. +
This is a background process that is controlled separately as described in the next section.

[[monitoring-console-disable]]
== Enabling Data Collection

The collection of monitoring data gets enabled and disabled in connection with the general configuration: _Monitoring_ -> _Monitoring Service_ -> _Enabled_

NOTE: If you want to remove the monitoring data collection from the server's runtime without disabling the monitoring service itself you must delete the `monitoring-console-core.jar` from the `as-install/modules` folder of your server installation and restart the server.

[[graphical-user-interface]]
== Graphical User Interface

After enabling the Monitoring Console open the home page at `/monitoring-console/` (usually on port `8080`).

The console comes with a set of xref:#preset-pages[preconfigured pages] each focussing on different aspects of the server.

NOTE: The console will let you know that some metrics are only available when the monitoring configuration of certain server parts is set to `HIGH`.

[[pages]]
=== Pages

The monitoring console is organized in fully customisable pages. A page is a collection of xref:#widgets[widgets] arranged in columns.

Usually pages are focused on visualising metrics of a specific area of the server, like the HTTP service or Request Tracing. The monitoring console has preconfigured pages as a starting point that can be changed and extended by the user.

New custom pages can be created if needed.

[[switching-pages]]
==== Switching Pages

To switch page use the drop-down menu at the top centre of the page.

image::monitoring-console/mc_page_menu.png[Page Navigation]

TIP: Each page switch also updates the URL making them "bookmarkeable". URLs can be copied and shared with others to share particular pages with them.

Updating URLs after switching pages also means that once the page is changed using the dropdown navigation, the browser's page history based navigation can be used to go back to already visited pages.

[[changing-page-layout]]
==== Changing Page Layout

Each page uses a column layout of 1-4 columns. The number of columns for a page can be changed using top right _Layout_ menu.

Changing the column layout of a page does not change the preferred position of the widgets. If a widget is set to column 3 but a 2-column layout is used all widgets of the 3rd or 4th column get pushed to the 2nd column instead. This allows switching layouts without redoing the configuration entirely.

[[changing-page-interval]]
==== Changing Page Update Interval

By default, the graphs on a page update every 2 seconds. To control the interval use top right _Data Refresh_ menu or open the _Settings_ and change the interval in the _Global_ settings.

image::monitoring-console/mc_settings_global.png[Global Settings]

The interval can be paused and continued without changing the interval duration by using the _paused_ checkbox next to the interval setting.

[[adding-pages]]
==== Adding Pages

To add a new page use the top right _Page_ menu and select _New..._.

This creates a new _Unnamed_ page which can be renamed in the _Page_ settings.

image::monitoring-console/mc_settings_page.png[Page Settings]

After naming the page xref:#adding-widget[add widgets].

[[deleting-pages]]
==== Deleting a Page

To delete a page open-top right _Page_ menu, select _Delete_ and confirm the browser confirmation dialogue.

NOTE: Pages that are based on a preset cannot be deleted. They can only be reset to default preset configuration.

[[reset-pages]]
==== Reset a Page

When the configuration of a preconfigured page or any of the widgets on it was changed by the user the page can be reset by selecting _Reset_ from the top right _Page_ menu.

WARNING: The reset will affect all widgets and the general page settings of the currently shown page. All changes made by the user will be overridden.

To reset all pages and remove all user created pages clear the browser's local storage for the monitoring console page.

[[page-management]]
==== Page Management

The Monitoring Console uses the browser's local storage to store the page configuration (which includes the widgets placed on a page). This means by default changes to page configurations do not affect other users.

To make pages available to others and to start from a common base configuration pages are explicitly synchronised with a persistent server page configuration.

The monitoring console can be used in one of three roles:

* _Guest_: A user that uses the console only on occasion to check existing metrics on existing pages ("read-only" user).
* _User_: A user that uses the console to experiment with its features without affecting others.
* _Administrator_:  A user that uses the console to configure the configuration that is the basis for other users.

The chosen role controls the behaviour and available options for the page synchronisation:

__Administrator__:: This role that is meant to manage the persistent server page configuration. The _Administrator_ pushes local changes to the server to update the base configuration.
__User__::
__Guest__::
They pull the server configuration to update their local configuration with the base.

The control remains with each user.

The _Page Synchronisation_ dialogue shown when entering the console UI allows the user to pick the pages that should be updated (pulled).

image::monitoring-console/mc_dia_pages.png[Page Synchronisation]

Based on the role the pages to synchronise are pre-selected.

* _Guest_: By default updates all pages available remotely unless they are already up-to-date.
* _Administrator_ and _User_: By default updates all pages available remotely unless a page has been locally changed.

The newest version is marked by a green background for easier orientation.

This dialogue can also be opened from the _Global_ settings by clicking the _Update Local Pages_ button shown _Page Sync_ property.

image::monitoring-console/mc_setting_global_rolesync.png[Global Page Synchronisation Settings]

__Administrators__ also find a button to _Update Remote Pages_ with any changes applied to local changes.

TIP: This is only needed for pages that are not using automatic updates.

To share a page that so far is not part of the persistent remote configuration open the _Page_ settings and look for the _Sync_ property:

image::monitoring-console/mc_setting_page_sync.png[Page Synchronisation Settings]

__Users__ and __Administrators__ can both _**Push**_ a page to update the persistent remote configuration and _**Pull**_ the remote configuration to update the local page.
__Administrators__ can also enable or disable the automatic page synchronisation.

NOTE: When enabled any local change done by an _Administrator_ is automatically pushed to the remote configuration and can be pulled by other users.

[[change-user-role]]
==== Changing User Role

When no role is set for the session the user is asked to choose a role when opening the monitoring console.

image::monitoring-console/mc_dia_role.png[Role Selection]

The selection can be changed at any time in the _Global_ settings for _Role_.

image::monitoring-console/mc_setting_global_rolesync.png[Role Setting]

[[page-settings]]
==== Page Settings

The individual page settings are explained in more detail in the context of the operations they are involved in. This table gives an additional overview.

.Page Settings
[cols="1,1,4",options="header"]
|====================
| Property | Default | Description
| Name | - | Name of the page; only editable for pages that do not originate from a preset
| Page Rotation | yes | Whether to include the page in the page rotation
| Type | _Manual_ | _Manual_ page (widgets added by the user) or _Query_ page (widgets added from query matches)
| Add Widgets (_Manual_ only) | - |   Selection of the series to add as a widget to the current page
| Max Size (_Query_ only) | - | Maximum number of widgets to place on the page from query matches
| Query Series (_Query_ only) | - | The series pattern to use to query for series to place on the page
| Query Interval (_Query_ only) | - | Number of seconds between repopulating the page with widgets from query matches, can be given using any time unit, e.g. `1min`, `30sec`, `1h`
| Sync (non _Guest_ role only) | - | _Push_ to update the shared state with the local page, _Pull_ to update the local state with the shared state
| Sync (_Admin_ role only) auto | yes | Whether to push changes to the local page to the shared state automatically when using the admin role
|====================

[[widgets]]
=== Widgets

Widgets are the components that can be placed on a page to show a particular metric. While there are different types of widgets usually a widget shows a line graph of one or more metrics for the entire cluster.

[[adding-widgets]]
==== Adding a Widget

Widgets can be added to any page. Open the side panel by clicking on _Settings_ top right menu.

Make sure the page is of _Type_ _Manual_. Pages of type _Query_ can be changed to _Manual_ as well which keeps them as they are for further manual customisation.

Use the _Select metric(s)_ button of the _Add Widgets_ property of the _Page_ settings to open the metric selection dialog.

image::monitoring-console/mc_settings_page.png[Page Settings]

In the selection dialog use the filters to find the metric you are looking for.

image::monitoring-console/mc_dia_add-metrics.png[Metric Selection Dialog]

When the metric is found in the list of matches check it to add it to the selection. After selecting one or more metrics to show in the widget confirm the selection by pressing _Ok_ button of the dialog.

.Selection Filters
[cols="1,5",options="header"]
|====================
| Filter | Description
| `Source` | Filter by the technology or area that provided the metric within the server
| `Namespace` | Filter by the namespace of a metric; this is the tag called `ns` at the start of a full series key `ns:x MetricName`
| `Group` | Filter by the group tag of a metric; this is the tag called `@` often found in the middle of a full series key `ns:x @:y MetricName`
| `Metric` | Filter by the metric name; this is last and only mandatory part of a full series key `MetricName`
| `Series` | Free text search by substring occurring in the full series key
| `MicroProfile Application` | Filter by the registry name containing a MircoProfile metric (which is equivalent with the application name)
| MicroProfile Type | Filter by the metric type as provided with MicroProfile metadata
| `MicroProfile Property` | Filter by the property of a MircoProfile metric; These are the different values available for the same metric object as individual series, for example the current, min and max counts of a counter. Note that not all actual properties of metric objects are available as metric series in the Monitoring Console.
| `MicroProfile Name` | Free text search for the name provided with MicroProfile metadata
| `MicroProfile Display Name` | Free text search for the display name provided with MicroProfile metadata (which defaults to the MicroProfile name if non was provided)
| `MicroProfile Description` | Free text search for the description provided with MicroProfile metadata
|====================

Filters that cannot be used in combination with chosen options of other filters are not shown and have no effect. They reappear as soon as they can be used.

When added, widgets are automatically placed in a column so that they are evenly distributed on the page. Use the xref:#configuring-widgets[side panel widget settings] to change column, span or item position of the widget or use the quick menu for the widget by clicking the cog symbol in the top right corner of the widget and select the action you want to apply to the widget.

NOTE: The widget series name field allows you to enter the name manually for advanced use cases or in case a metric is not available now but known to become available at some point. See xref:#using-advanced-data-series[Series with Wildcards] for more details.

[[populate-widgets-from-queries]]
==== Populate Widgets from Queries

The second form of populating a page is to not manually add widgets to it but to define a series query. Matching metrics will be used to automatically populate the page with widgets.

To use this option change the page _Type_ to _Query_ in the _Page_ settings.

image::monitoring-console/mc_settings_page_query.png[Page Settings]

At a minimum the _Query Series_ has to be defined. This should be a series using a pattern containing wild-cards (see xref:#using-advanced-data-series[Series with Wildcards] for more details).

The matching series are ordered and placed on the page in intervals. The interval is controlled by the _Query Interval_ property. Usually the interval is between `1 minute` and `1 hour`. If no interval is given the page will first update after `365 days`.

The _Update_ button can be used to force a page update before the next interval starts and ends. Changes to the _Query Series_, _Query Interval_ or _Max Size_ do not have immediate effect and can be applied immediately using the _Update_ button.

Depending on the _Query Series_ and its potential to match vast numbers of metrics it can be a good idea to limit the maximum number of widgets automatically placed on the page by the population from query using the _Max Size_ property.

[[configuring-widgets]]
==== Configuring Widgets

To configure a widget select it by clicking on its title.

This opens the side panel and shows the detail configuration of the widget. The side panel can be closed by either deselecting the widget, by clicking on its title again, or by clicking the _Settings_ menu or its _Hide_ item.

NOTE: If the settings have been opened explicitly through the _Settings_ menu an empty selection will not close the settings side panel.

The _Widget_ settings are concerned with the widgets position within the page.

image::monitoring-console/mc_settings_widget.png[Widget Settings]

.Widget Settings
[cols="1,1,4",options="header"]
|====================
| Property | Default | Description
| Display Name | `(undefined)` | Optional name to customise the displayed widget title. If no name is given the _Data Series_ is shown.
| Type | `Time Curve`  | Changes the type of graph used to show the metric. This also affects which data of the metric the widget is focussed on. Possible choices:
`Time Curve`: a line chart of current values (usually last 60 seconds),
`Range Indicator`: show distributions of values (of last 60 seconds),
`Alerts`: shows a table of alerts,
`Annotations`: shows a table or list of annotations; these are key-value attributes associated with a metric series,
`RAG Status`: Shows a red, amber, green tableau for the status of the series per instance. This should only be used with series of _Data_ _Unit_ of type `Up/Down`
| Mode | _(Default)_ | If available for the type of widget the display mode can be switched between _Table_ and _List_.
Table view is best fitted for annotations that share common attributes, lists are better fitted for annotations with potentially differing attributes.
| Column | 1  | The column in the layout the widget *prefers* to be in.
| Item   | 1  | Within columns widgets are sorted by their item value, lowest values first. The item position is automatically updated during page layout should it be needed.
| Size   | 1 / 1 | How many width (number of columns) and height (number of rows) the widget should span. Note that this is a target size. If page number of columns is reduced the width might be reduced to match the page layout.
|====================

The _Data_ settings are concerned with what and how the data is shown in the graph of a widget.

image::monitoring-console/mc_settings_data.png[Widget Data Settings]

.Data Settings
[cols="1,1,4a",options="header"]
|====================
| Property | Default | Description
| Series | - | The key(s) of the data series shown in the graph. Use _Change metric(s)_ button to change metrics linked to the widget.

NOTE: Only series of the same unit (same Y-axis) are meant to be shown in the same graph. Multiple series of different Y-axis are currently not supported.
| Unit | `Count` | The unit controls how the raw number of a metric is interpreted and represented e.g. when displaying in axis labels. The unit also controls what values are accepted as input for numbers, like thresholds, that are on the same axis.

Possible units are: `Count`, `Milliseconds`, `Nanoseconds`, `Bytes`, `Percentage`, `Up/Down` (0 is `DOWN`, anything above is UP).
| Unit 1/sec | `false` | Whether to show the metric as a change per second (delta between two points in the series normalised to average delta per second).
| Upscaling | (undefined) | When defined all values are multiplied by this factor. This can e.g. be used to move a decimal range between zero and one to a percentage range 0-100.
| Upscaling _decimal value_ | `false`
| Check to mark the metric as one that is provided as a decimal value during collection (floats or doubles and alike). This will then revert the conversion applied during collection which converts decimal values to an integer number with 4 available decimal digits by multiplying them by `10,000`.

So this divides values by 10,000 again to move them back into their original value range.
| Extra Lines | `(none checked)` | Check to add either the all, minimum, maximum or average line time to the graph
| Lines | (none checked) | Options on how to display the current value line in the graph: Check _Points_ to show individual data points on the line, check _Curvy_ to use Bézier curves instead of straight line connections.
| Background | _Fill_ | When _Fill_ is checked the area between line and axis is filled. The background transparency can be configured globally in the _Colors_ settings.
| X-Axis | _Labels_ | Whether to show labels for the x-axis.
| Y-Axis | (undefined) | Set a minimum or maximum number for the y-axis instead. When not set range is derived automatically from the data points.
| Coloring | _Instance Name_ | Used to select the colours the data is shown with.

* _Instance Name_ will show data in the same colour that belongs to the same instance.
* _Series Name_ shows the metric series in the same colour (independent of instance). This is individual to each widget.
* _Result Set Index_ will show each matching series in a different colour.
* _Instance and Series Name_ shows the same instance and series in the same colour. This is global.
+
This means another widget using this colouring with the same instance and series will have the same colour as well.
| Fields | _(blank)_ | A comma or space separated list of fields to show for an annotation list or table. The given field order is reflected in the view.
| Annotations | (checked) |  Whether to show annotations for an alert table.
|====================

[[configure-widget-decorations]]
==== Configuring Widget Decorations

Decorations are visual helpers that can be added to a graph of a widget in order to make it easier to for the user to quickly understand the data displayed.

In particular these are reference lines.

image::monitoring-console/mc_settings_decorations.png[Widget Decoration Settings]

[cols="1,1,4a",options="header"]
|====================
| Property | Default | Description
| Waterline | `(undefined)` | Adds a simple reference line that could mark an upper or lower limit.

Enter in unit of y-axis, e.g. `20ms`, `5s`, `2GB`, `4%`, `123`
| Threshold Reference | `Off` | Controls what value the _Alarming Threshold_ and _Critical Threshold_ are compared to.

Usually this is the most recent value but in some cases the all time minimum, maximum or average are useful too.
| Alarming Threshold | `(undefined)` | The limit for the _"Alarming"_ state.

If _Critical Threshold_ is undefined or if it's value is larger than this value the alarming threshold is exceeded if the reference value is larger than the threshold.

Otherwise, if the _Critical Threshold_ is lower than the _Alarming Threshold_, the threshold becomes 'inverse', and is exceeded when the reference value falls below the alarming value.

When exceeded the status becomes _"Alarming"_.

Enter in unit of y-axis, e.g. `20ms`, `5s`, `2GB`, `4%`, `123`
| Critical Threshold | `(undefined)` | The limit of the _"Critical"_ state.

If _Alarming Threshold_ is `undefined`, or it's value is smaller than this value the critical threshold is exceeded if the reference value is larger than the threshold. Otherwise, if the _Critical Threshold_ is lower than the _Alarming Threshold_, the threshold becomes 'inverse', and is exceeded when the reference value falls below the critical value.

When exceeded the status becomes _"Critical"_, overrides status _"Alarming"_.

Enter in unit of y-axis, e.g. `20ms`, `5s`, `2GB`, `4%`, `123`
|====================

Besides adding a reference line to the graph the critical and alarming thresholds affect the status evaluation.

Use the colour input to individually override the widget's colour for waterline, alarming line or critical line in graphs.

Press the button right next to it which shows the default colour as configured in the _Colors_ settings to reset the individual colour to use the default setting instead. A colour set to the default changes with the default.

[[configure-widget-status-messages]]
==== Configuring Widget Status Messages

The current value of a metric can automatically be categorised as a certain status. For example based on the threshold values of decorations or by encountered errors or missing data. The _Status_ settings allows to set a custom message for a particular status.

image::monitoring-console/mc_settings_status.png[Widget Status Settings]

[cols="1,1,4",options="header"]
|====================
| Property | Default | Description
| `No Data` | `(undefined)` | The message to show when no data for a metric is available. For example to hint about configurations needed to make the metric available.
| `Alarming` | `(undefined)` | The message to show when the threshold got exceeded and the status evaluates to _Alarming_.
| `Critical` | `(undefined)` | The message to show when the threshold got exceeded and the status evaluates to _Critical_.
|====================

The messages support simple markup using `pass:[*]boldpass:[*]` and `pass:[_]italicpass:[_]`.

[[configure-widget-alerts]]
==== Configuring Widget Alerts

The values of metric series can be tracked by the server to report values that out of a healthy range.

This is represented by these states:

* _Red_: values in this range indicate an unhealthy state
* _Amber_: values in this range indicate a degraded state
* _Green_: values in this range indicate a healthy state
* _White_: values in this range are in no particular state (neither good nor bad, maybe undecidable)

image::monitoring-console/mc_settings_alerts.png[Widget Alerts Settings]

[cols="1,1,4a",options="header"]
|====================
| Property | Default | Description
| Show | (all checked)
| Filters that allow to control the type of alerts that should be shown.

Include _Amber_ and/or _Red_ alerts, _Ongoing_ and/or _Stopped_ alerts, _Acknowledged_ and/or _Unacknowledged_ alerts.

If for any of these 3 groups of pairs both are unchecked the list will be empty. Widgets of type _Time Curve_ automatically exclude stopped and acknowledged alerts to avoid cluttering the graph with alerts that aren't relevant anymore.

Use a widget of type _Alerts Table_ to show all alerts according to the filter at all times.
|====================

[[handling-alerts]]
==== Handling Alerts

Alerts can occur when a watch is configured for a metric series.

A watch describes the conditions and thresholds used to determine a state from the recent values of a metric series. It is either _Red_ (unhealthy), _Amber_ (degraded), _Green_ (healthy) or _White_ (undetermined).

A _Red_ or _Amber_ state causes an alert that is shown on top of the graph.

image::monitoring-console/mc_sample_alert-graph.png[Alert for a line graph]

When an alert occurred for a metric shown in a graph the background of the line causing the alert is coloured in _Red_ or _Amber_ default colour until the alert is stopped.

Alerts are considered ongoing as long as the state is _Red_ or _Amber_.
If it is evaluated to _Green_ or _White_ the alert stops. Stopped alerts are no longer shown on top of line graphs. Another way to remove an alert from the line graph is to acknowledge the alert by checking its checkbox.

To see stopped or acknowledged alerts add a widget of type _Alert Table_.

image::monitoring-console/mc_sample_alert-table.png[Alert Table]

By default, an alert table shows all alerts including stopped and acknowledged alerts. Use the widget _Alerts_ settings to exclude alerts with certain properties.

Alert table shows the overall state of each instance in the table's legend.

_Alerts_ settings can equally be used for line graphs to create a more restrictive setting.

NOTE: Currently, watches are only added programmatically as part of the server. User defined watches are not yet possible.

[[remove-widgets]]
==== Removing a Widget

Any widget can be removed from any page. Click the cog symbol in the top right of the widget, select _Remove_ and confirm the browser dialogue.

Remember that a page originating from a preset can be reset to recover a widget that was removed accidentally.

[[using-advanced-data-series]]
==== Using Advanced Data Series

A series is a name or key for a particular metric shown in a widget.
Each metric has a unique key or series name. Usually these names use _tags_ to categorise metrics into groups. For example:

----
ns:jvm MetricName
ns:jvm @:groupName MetricName
----

The patterns shown above exemplify conventions used throughout Payara monitoring console. The first grouping level usually is the `ns` (short for namespace), the second the `@` (short for _group_).

In the example the metrics belong to the `jvm` namespace and the `groupName` group within that namespace.

When metrics are selected using the dropdowns these details are filled in for the user by selecting items from the dropdowns. Alternatively, a user may choose to enter the series key manually which allows using a wild-card _star_ instead of either a tag value (like `jvm`) or the _MetricName_. For example:

----
ns:jvm @:* Duration
----

This will then match all existing series that match the pattern. This feature can be used to automatically show all metrics of a certain pattern in a single widget as it is done by the request tracing page.

[[global-configurations]]
=== Global Configurations

The configuration that controls the monitoring console UI is stored in the browser's local storage.

For manual sharing the configuration can be exported and imported in the form of JSON files. Server integrated sharing can be done using the built in page synchronisation which is a two-way update mechanism to update either the local configuration with server configuration or the other way around which allows the sharing of changes made by one user with other users in a more convenient way.


.Global Settings
[cols="1,1,4",options="header"]
|====================
| Property | Default | Description
| Data Refresh | `2s` | Interval duration used to update the currently shown page with new data (poll duration).

To pause any page update check _enabled_ checkbox.
| Page Rotation | (undefined duration) | Duration each page is shown during page rotation.

To run a rotation enter an interval duration using a number with time unit and check the _enabled_ checkbox.

To stop rotation un-check the _enabled_ checkbox.
| Role | _User_ | Select the used user role.

See section xref:#change-user-role[Changing User Role] for details.
| Page Sync | -
| _Update Local Pages_ button opens the dialog to pull page configuration updates from server (not available to _Guest_ role).

_Update Remote Pages_ button pushes changes to local pages to remote (server) if such a page already exist remotely (_Administrator_ role only).
| Watches | - | Just a short-cut to the watches configuration page
|====================

[[configuration-export]]
==== Configuration Export

A configuration contains all pages. All changes made to a page or widget setup are contained in this configuration. To download this configuration as a JSON file select _Export_ from the _Settings_ top right menu.

[[configuration-import]]
==== Configuration Import

To import a previously exported JSON file select _Import_ in the top right _Settings_ menu and select the JSON file to import.

This feature can be used to version and distribute configurations for similar installations.

WARNING: Importing files will override any changes made to pages existing in both the current configuration and the imported file. +
Importing pages will not remove pages that are not contained in the imported file.

[[page-rotation]]
==== Page Rotation

The Monitoring console is built with the intention of being used to display metrics on status monitors. To allow viewing a variety of pages and their metrics on a single screen the pages can be automatically rotated showing each page for a configured interval duration.

To enable page rotation open the _Settings_ and check the _enabled_ checkbox in the _Global_ Settings _Page Rotation_ property. This starts the rotation immediately.

image::monitoring-console/mc_settings_global.png[Global Settings]

The duration can be adjusted changing the text field of the _Page Rotation_ to another time value. Use units to express the duration, as for example: `1min`, `30sec`. Changes take effect immediately.

The rotation will show each page for the configured duration.
Pages can be excluded from rotation by switching to the page using the page menu.
Open the _Settings_ and uncheck the _Include in Rotation_ checkbox in the _Page_ settings.

[[color-configurations]]
=== Color Configurations

Newer versions of the Monitoring Console allow to configure the colours used in graphs. There is a global colour configuration affecting all graphs.

image::monitoring-console/mc_settings_colors.png[Widget Status Settings]

.Colors Settings
[cols="1,1,4",options="header"]
|====================
| Property | Default | Description
| Scheme | -
| The selected scheme is applied to set the colours palette for _Data_ as well as _Defaults_ and _Opacity_.

This is only a convenient way to switch all of these between different settings.

The individual properties can be changed afterward as usual without affecting the scheme.
| Data # (Palette) | (colours of _Payara Branding_ scheme)
| The list of colours to use when colouring data series in graphs.

This is the line colour in line charts or the bar colour in bar charts. Background will use the same colour with _Opacity_.

Add new colours by using the `+` button.

The `-` button removes the last colour of the list.

If there are fewer colours in this palette than needed for different lines in a graph new colours are derived based on this palette.

The derived colours focus on bright colours with high contrast but might not always fit well with the rest of the palette. In such case consider adding more colours to the palette.
| Defaults | (default of _Payara Branding_ scheme)
| Sets the default colours for _Waterline_, _Alarming_ and _Critical_ as well as _Red_, _Amber_, _Green_ and _White_ state lines, backgrounds and texts.

Some of these can be individually overridden in the widget's configuration for these lines.
| Opacity | 10
| Background opacity for lines or bars in graphs, 0 (fully transparent) to 100 (solid).
| Thickness | (3)
| Line width on a scale 1-8. Each point corresponds to 0.5px with. Default for lines in a line graph is 3, so 1.5px.
|====================

[[user-defined-watches]]
=== User Defined Watches

A watch describes the conditions to meet to start and stop alerts in relation to a specific metric. For example to get an alert every time an HTTP request causes a server error (responds with any of the 5xx status codes) a custom watch is installed. This is very similar to a custom health check that could be linked to any metric available where the thresholds are defined as part of the watch.

There are many varieties of conditions that can be formulated. Each watch has a start condition which when met starts a new alert.

Optionally a stop condition can be given which when met will stop the alert. If no such stop condition is given an alert stops as soon as its start condition is no longer met.

Such pairs of start and stop conditions can be defined for 3 levels:

Unhealthy:: corresponds to a "red" alert
Degraded:: corresponds to an "amber" alert
Healthy:: conditions for particularly good values, these will not cause alerts but can be used to mark a _healthy_ range in graphs.

Each watch must have at least an _Unhealthy_ or a _Degraded_ condition.
When both are given alerts can transition between _Degraded_ and _Unhealthy_ as the same issue or alert.

_Unhealthy_ takes precedence over _Degraded_ and _Healthy_, _Degraded_ takes precedence over _Healthy_ should their condition be met at the same time.

Should a _Degraded_ alert be acknowledged, but it transitions to _Unhealthy_ afterward the acknowledgement is reset so this change is not missed.

[[creating-watches]]
==== Creating a Watch

To create custom watches go to the _Watches_ page using the top page menu or the _Global_ settings.

image::monitoring-console/mc_page_watches2.png[Creating a Watch]

The above example shows a relatively simple watch named _HTTP server errors_. The name of the watch can be anything as long as it is unique.

The watch should have both an _Unhealthy_ and a _Degraded_ level.

The field after the _If_ holds the name of the metric series the watch is linked to, in this case the `ns:http ServerCount5xx` metric, as shown on the _HTTP_ page. The _in_ clause specifies the unit type of the given metric, here it is the `Count` of 5xx responses. Following _is_ the comparison operator is selected, here `>`. This is followed by the threshold value, here `3` or `1`, and the scope of the comparison, here `in sample`.

As both do not use a stop condition the checkbox after _until_ is not checked.

The below table describes possible choices for each step of a watch condition.

.Watch Condition Segments
[cols="1,1,3",options="header"]
|====================
| Segment | Start/Stop | Description
| `If` _metric-series_ | Both
| Give the name of the metric series to watch. As monitoring is a generic, dynamic and open system there is no definitive pre-defined list of available metrics.

The metrics currently available are listed at http://localhost:8080/monitoring-console/api/series/ (assuming a locally run DAS).
| `in` _unit_ | Both
| Select the unit for the given metric series.

This should be the same unit given in widget configuration _Data_ property _Unit_. Depending on the chosen unit the threshold can be given in values of this unit, e.g. when selecting _Milliseconds_ the threshold can be given as `1s` for 1 second.
| `is` _operator_ | Start
| Select the comparison operator to use when comparing the actual value(s) to the threshold.

The comparison is of form _actual operator threshold_.
| `is` _threshold_ | Start
| The numeric threshold. The upper/lower limit. With the right unit selected the number can be given with a unit such as `5min` for time units, or `4KB` for bytes.
| `is` _scope_ | Start
| Select a scopes for the actual values that are compared to the threshold. The semantics of the different scoped are described in a separate table below.
| `is` _scope-length_ | Start
| The length defines how many of the most recent data points of the watched metric are included in the scope of the comparison.

A number with time unit refers to the number of the points, a number with time unit to the duration of points to consider for the scope.
| `until` _operator_ | Stop | Same as for `start`
| `until` _scope_ | Stop | Same as for `start`
| `until` _scope-length_ | Stop | Same as for `start`
|====================

The below table describes the semantics of the different types of comparison scopes.

.Watch Condition Scopes
[cols="1,3",options="header"]
|====================
| Scope | Description
| `for last` | The comparison must be true for each point in the scope for the condition to be met. Similar to an _all_ logic.

The number of points included is specified afterward.

This is either a bare number referring number of points to include or a number with a time unit referring to a duration where all points within the duration from most recent point backwards are included in the scope.
| `for average of last`
| The comparison must be true for the single average value of all points in the scope for the condition to be met.

The number of points included is specified afterward as number of duration from which to consider points.
| `in last`
| The comparison must be true for at least one of the points included in the scope for the condition to be met.

Similar to an _any_ logic. The number of points included is specified afterward as number of duration from which to consider points.
| `in sample`
| The comparison must be true for at least one of the points available for the condition to be met.

For this scope type no length is given as all available points are considered. This can vary but usually consists of the last minute of data.
|====================

After composing the watch conditions press _Save or Update_ to install the watch.
If a watch of the same name already exists the existing watch is replaced.

Watches that originate from server modules cannot be replaced. To change them disable the existing watch and click to edit it, this will create a duplicate with a different name that can be adjusted freely.

[[editing-watches]]
==== Editing a Watch

To edit a previously created watch click on its name in the list of watches or chose _Edit_ from the cogs menu on the right.

Watches that originate from server modules cannot be edited. When clicking their names or when choosing _Duplicate_ from their cogs menu a duplicate with a different name is created. The suggested name _Copy of {original name}_ can be changed as long as it is different to existing watch names.

When changing the name of an edited watch to an existing name this overrides that watch. In other words watches are always identified by their name.

[[enabling-or-disabling-watches]]
==== Enabling or Disabling a Watch

Go to the _Watches_ page using the top page menu or the _Global_ settings.

image::monitoring-console/mc_page_watches1.png[List of Watches]

The status of each watch is reflected by the checkbox left of the watches name, checked for enabled, unchecked for disabled.

TIP: Disabled or stopped watches names are also greyed out.

To disable an enabled watch un-check the checkbox or use the _Disable_ item from the cogs menu on the right of the watch widget. To enable a disabled watch check the checkbox or use the _Enable_ item from the cogs menu. The change has immediate effect.

[[preset-pages]]
=== Preconfigured Pages

The following is a list of pre-configured pages already available to users by default in the monitoring console.

[[core-page]]
==== Core Page

The _Core_ page gives an overview of some of the important instance metrics.
Each instance in the grid is shown separately.

image::monitoring-console/mc_page_core.png[Core Page]

* _Active Sessions_: Total number of active session for the instance.
* _Thread Count_: Total number of threads used by the instance.
* _Request Count_: Number of HTTP request per second processed by the instance.
* _Heap Usage_: Percentage of the current instance maximum heap memory already used.
* _CPU Usage_: Percentage CPU usage by the instance (not the machine but the process).
* _Thread Pool Current Thread Usage_: Percentage of HTTP thread pool threads currently in use by the instance.

[[http-page]]
==== HTTP Page

The _HTTP_ page gives a rough overview of the state of the HTTP services of each instance.

image::monitoring-console/mc_page_http.png[HTTP Page]

* _Connection Queue Count Open Connections_: Total number of open connection in the connection queue
* _Thread Pool Current Threads Busy_: Number of threads in the HTTP thread pool currently processing an HTTP request.
* _Server Count2xx_: Requests per seconds and instance responding with Success.
* _Server Count3xx_: Requests per seconds and instance responding with Redirection.
* _Server Count4xx_: Requests per seconds and instance responding with Client Error.
* _Server Count5xx_: Requests per seconds and instance responding with Server Error.

[[jvm-page]]
==== JVM Page

The _JVM_ pages gives a general overview of the state of the JVM running Payara Server.

image::monitoring-console/mc_page_jvm.png[JVM Page]

* _Used Heap_: Total size of the used heap memory
* _Heap Size_: Size of the committed (reserved) heap memory (OS level)
* _Loaded Classes_: Total number of loaded classes
* _Unloaded Classes_: Total number of unloaded classes
* _Live Threads_: Total number of threads used by the JVM (including daemon threads)
* _Daemon Threads_: Total number of daemon threads used by the JVM

[[monitoring-page]]
==== Monitoring Page

A page that shows key metrics on the monitoring system itself that feeds the monitoring console with data.

This is mostly useful to identify problems with the monitoring system or to cross-check that unexpected metric values aren't caused by general problems with monitoring.

image::monitoring-console/mc_page_monitoring.png[Monitoring Page]

* _Source Times_: Shows the duration it took to collect metric data from the individual sources within the server. Durations should be well below a second. Usually in two digit millisecond range.
* _Sources_: Number of sources metrics are collected from in a particular second. This varies as some sources are collected in an interval of several seconds.
* _Sources with Errors_: Shows how many of the sources that were collected caused an error during collection that potentially ends the collection of that source so that some metrics usually provided by that source might no longer be collected. This can explain missing metrics.
* _Metrics Time_: The total time it took to collect all sources. As collection happens once every second this should be well below 1 second.
+
This metric is watched and alerts are created should the time exceed 600ms for multiple times in a row. This time can vary a lot depending on the server configurations as sources are enabled and disabled. It can also be influenced strongly by the deployed applications as they can contribute metrics in large numbers.
* _Watches Time_: The total time it took to collect and evaluate all watches. This time is less critical, but it should usually be well below 1 second. Typically, in the range of two digit milliseconds.
* _Alerts_: The total number of ongoing (active) alerts.

[[health-checks-page]]
==== Health Checks Page

A page that gives an overview of the state of the server health checks.
The individual checks need to be enabled in the server _HealthCheck_ configuration.

NOTE: It is not required to enable the _HealthCheck service_ in the general tab in case the checks should only be enabled for metrics based monitoring without causing health check notifier messages.

image::monitoring-console/mc_page_health-checks.png[Health Checks Page]

* _CPU_: CPU Health Check, percentage of CPU used by the server instance during last 4 seconds
* _GC_: Garbage Collection Health Check, percentage of time used to collect garbage objects during the last 4 seconds
* _Memory_: Machine Memory Usage Health Check, percentage of the total available physical memory used
* _Heap_: Heap Memory Usage Health Check, percent of total available heap memory used by the JVM
* _MP Health_: MicroProfile Health Check, percent of instances that respond with `UP` status to a liveliness health endpoint request (this includes the DAS that is the only instance that is performing this check every 12 seconds)
* _Connection Pool_: Connection Pool Health Check, percent of connections currently used for each JDBC connection pool
* _Alerts_: A list of all health check related alerts

[[thread-health-page]]
==== Thread Health Page

The _Threads_ page gives detailed information on thread health of the cluster and lists information on stuck or hogging threads. Total number of live and daemon threads are given for reference.

image::monitoring-console/mc_page_threads.png[Thread Health Page]

* _Stuck Thread Incidents_: Table listing the most recent information for threads that are considered stuck.
+
This is the case if the time passed since a thread started a not yet finished unit of work becomes longer than the set threshold in the _Stuck Threads_ health check configuration.
+
This could be because it is waiting at a lock or the operation takes a considerable amount of time.
* _Hogging Thread Incidents_: Table listing the most recent information for threads that are considered hogging.
+
This is the case if the thread's use of the CPU in percent points is higher than the threshold value configured in the _Hogging Threads_ health check configuration for `n` times in a row, where `n is 1 + the configured number of retries`.
* _Live Threads_: Total number of threads used by the JVM (including daemon threads)
* _Daemon Threads_: Total number of daemon threads used by the JVM

WARNING: Be aware that the number shown in the example image are not characteristic. For demonstration purposes the thresholds have been set uncharacteristically low to be able to "force" entries. +
Usually the threshold for stuck threads should be in region of some seconds to a few minutes. The threshold for hogging threads should be well above 90% with a few retries.

[[request-tracing-page]]
==== Request Tracing Page

The _Request Tracing_ page overview page shows traces that exceeded the set threshold.

NOTE: If this page does not show any data, no request has exceeded the threshold or the request tracing has not been enabled. Check _Configuration_ => _Request Tracing_.

The _Trace Duration Range_ widget shows all traces for the same method as a single bar. The length and position of the bar gives the range of total trace duration for all the occurrences that exceeded the threshold.

The bar starts at the minimum duration observed and ends at the maximum duration observed in the last minute. The legend shows the average duration and the method traced (innermost trace span operation)

image::monitoring-console/mc_page_request-tracing.png[Request Tracing Page]

When all time minimum and/or maximum are added in the _Widget Data_ settings the bar starts and/or ends at these "all time" values instead of the minimum and/or maximum within the last minute.

The _Trace Duration Above Threshold_ widget shows a graph where each point marks the duration of a "slow" request at the moment the requests occurred. Possible alerts are shown on top of the graph.

The _Trace Data_ view adds tracing details for the "slow" requests that can be sorted by wall-time or value using the widget menu (gear icon in top right corner of the widget).

By clicking on one of the bars in the overview's _Trace Duration Range_ widget the details of all kept traces for this method can be viewed. This data corresponds to the traces stored in the trace-store.

For each trace, each of the spans corresponds to a bar in this graph.

image::monitoring-console/mc_page_request-tracing2.png[Request Tracing Details Page]

By default, the traces are sorted longest (slowest) to shortest (fastest) total duration. On the time axis the spans are shown relative to the start of the trace.

When the side panel is opened the details of each trace span can be viewed by clicking on the span bar.

The legend gives average durations for each of the spans occurring for the traced method.

NOTE: The detail view does not automatically refresh. To refresh click the refresh icon next to the _Sorting_ menu in the top right of the widget.

The spans can be sorted by wall time by selecting _Sort by Wall Time_ or by duration by selecting _Sort By Duration_ in the _Sorting_ menu in the top right of the widget.

To get back to the overview close the details by clicking the x-icon on the right side of the _Sorting_ menu.

WARNING: Be aware that the graphs in the example images above show unrealistically low numbers due to the way that request tracing was configured. In a more realistic configurations the durations are more likely to be in range of few hundred milliseconds to some seconds.

[[sql-page]]
==== SQL Page

The _SQL_ page gives insight into slow SQL queries for all connection pools configured in Payara Server.

NOTE: To capture slow SQL queries the _JDBC Connection Pool_ configuration's _Slow Query Log Threshold_ in the _Advanced_ tab needs to be set to a positive number.

image::monitoring-console/mc_page_sql.png[Slow SQL Page]

* _Slow SQL Queries_: Shows SQL details for queries that were too slow. _Value_ refers to the duration of the SQL query.
* _Worst SQL Execution Time_: Shows SQL query activity. Each data point gives the duration of the slowest query run during last second. Zero means no SQL query was run.
* _Slow SQL Alerts_: A list of alerts caused by too slow SQL queries in reference to the _Slow Query Log Threshold_ given in the pool configuration.
+
Single outliers cause a degraded state (amber alerts), outlier groups cause unhealthy state (red alerts).

[[alerts-page]]
==== Alerts Page

The main use of the _Alerts_ page is to check for any server alerts. The page is split into two lists: the upper list containing all ongoing alerts, and the lower list containing past alerts.

As always for alert lists both lists are sorted starting with the most recent severe alert progressing to the oldest least severe alert. Annotations associated with alerts are hidden in this view to make room for more alert entries.

image::monitoring-console/mc_page_alerts.png[Alerts Page]

NOTE: Past alerts can be managed by acknowledging the alerts which makes them disappear from the list.

[[application-metrics-page]]
==== Application Metrics Page

This page uses a query to populate the page with widgets for series that originate from the MicroProfile Metrics of the server and applications deployed on the server.

As this potentially are very many series the page by default is limited to at most 32 of them. The automatic placement will choose those series that show most dynamic. By default, the widget placement is updated every minute. This means the order and selection of widgets placed on the page can change once a minute based on their most recent dynamics.

The defaults can be customised using the _Page_ settings.

[[rag-status-page]]
==== RAG Status Page

Like the application metrics page this page uses a query to populate the page with widgets automatically.

The metric series originate from the _MicroProfile Health_ checks of the server and any of the deployed applications. The purpose of this page is to give a quick strong visual indication of the health status of the cluster based on _MicroProfile Health_ checks.

Each _MicroProfile Health_ check is represented as a widget which shows the current status of the check in red (down for a while), amber (just went down) or green (up) for each of the instances where the check is performed.

image::monitoring-console/mc_page_rag.png[RAG Status Page]

In the example these are the checks _Service1_ and _Service2_ of the _health-demo-1.0-SNAPSHOT_ application.

In addition to the _MicroProfile Health_ checks there are aggregate metric series for each type (_Health_, _Liveness_, _Readiness_) per application and for the cluster as well as an aggregate _Overall_ combining the three types health, liveness, readiness into a single metric series per application and for the cluster.

[[user-defined-metrics]]
=== User Defined Metrics

The monitoring console is build with the intention to allow user defined metrics to be visualised. So far these include the MicroProfile Metrics that might originate from a deployed application and other extensions of the server.
These are included in the available metrics automatically.

Open the _Settings_ click _Select metric(s)_ button for _Add Widgets_ property in the _Page_ settings and select the _MicroProfile Metrics_ as _Source_ in the selection dialog.

image::monitoring-console/mc_dia_microprofile.png[Page Selection for MP Metrics]

Eventual MP tags used become the `@` group of the shown series key, the MP metric stays the metric name.

[[user-defined-alerts]]
=== User Defined Alerts

At current stage alerts cannot be defined in the monitoring console application by the user. While the infrastructure for custom alerts is available a GUI has not been added yet.

That means so far alerts are only configured for health checks and the monitoring collection.
